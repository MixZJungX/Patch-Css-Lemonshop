# ЁЯФз р╕Бр╕▓р╕гр╣Бр╕Бр╣Йр╣Др╕Вр╕Ыр╕▒р╕Нр╕лр╕▓р╕Др╕┤р╕зр╕Лр╣Йр╕│

## р╕Ыр╕▒р╕Нр╕лр╕▓р╕Чр╕╡р╣Ир╕Юр╕Ъ
- р╕гр╕░р╕Ър╕Ър╣Др╕бр╣Ир╕кр╕▓р╕бр╕▓р╕гр╕Цр╕кр╕гр╣Йр╕▓р╕Зр╕лр╕бр╕▓р╕вр╣Ар╕ер╕Вр╕Др╕┤р╕зр╣Гр╕лр╕бр╣Ир╣Др╕Фр╣Йр╣Ар╕Щр╕╖р╣Ир╕нр╕Зр╕Ир╕▓р╕Бр╕бр╕╡р╕лр╕бр╕▓р╕вр╣Ар╕ер╕Вр╕Др╕┤р╕зр╕Лр╣Йр╕│р╕Бр╕▒р╕Щ
- Error: `duplicate key value violates unique constraint "queue_items_queue_number_key"`
- р╕ер╕╣р╕Бр╕Др╣Йр╕▓р╣Др╕бр╣Ир╣Ар╕лр╣Зр╕Щр╕Др╕┤р╕зр╕лр╕ер╕▒р╕Зр╕Ир╕▓р╕Бр╣Бр╕ер╕Бр╣Вр╕Др╣Йр╕Фр╣Ар╕кр╕гр╣Зр╕И

## р╕зр╕┤р╕Шр╕╡р╕Бр╕▓р╕гр╣Бр╕Бр╣Йр╣Др╕В

### 1. р╣Бр╕Бр╣Йр╣Др╕Вр╣Вр╕Др╣Йр╕Ф (р╕Чр╕│р╣Бр╕ер╣Йр╕з)
- р╕Ыр╕гр╕▒р╕Ър╕Ыр╕гр╕╕р╕Зр╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щ `generateQueueNumber()` р╣Гр╕лр╣Йр╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕лр╕бр╕▓р╕вр╣Ар╕ер╕Вр╕Др╕┤р╕зр╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф
- р╣Ар╕Юр╕┤р╣Ир╕бр╕Бр╕▓р╕г retry р╣Гр╕Щр╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щ `addToQueue()` р╣Ар╕бр╕╖р╣Ир╕нр╣Ар╕Бр╕┤р╕Ф duplicate key
- р╣Ар╕Юр╕┤р╣Ир╕бр╕Бр╕▓р╕гр╕Ир╕▒р╕Фр╕Бр╕▓р╕г error р╕Чр╕╡р╣Ир╕Фр╕╡р╕Вр╕╢р╣Йр╕Щ

### 2. р╣Бр╕Бр╣Йр╣Др╕Вр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Гр╕Щр╕Рр╕▓р╕Щр╕Вр╣Йр╕нр╕бр╕╣р╕е

#### р╕зр╕┤р╕Шр╕╡р╕Чр╕╡р╣И 1: р╕ер╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Др╕┤р╕зр╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф (р╣Бр╕Щр╕░р╕Щр╕│)
```sql
-- р╕гр╕▒р╕Щр╣Гр╕Щ Supabase SQL Editor
DELETE FROM queue_items;
```

#### р╕зр╕┤р╕Шр╕╡р╕Чр╕╡р╣И 2: р╣Бр╕Бр╣Йр╣Др╕Вр╕лр╕бр╕▓р╕вр╣Ар╕ер╕Вр╕Др╕┤р╕зр╕Чр╕╡р╣Ир╕Лр╣Йр╕│
```sql
-- р╕Фр╕╣р╕лр╕бр╕▓р╕вр╣Ар╕ер╕Вр╕Др╕┤р╕зр╕Чр╕╡р╣Ир╕Лр╣Йр╕│
SELECT queue_number, COUNT(*) 
FROM queue_items 
GROUP BY queue_number 
HAVING COUNT(*) > 1;

-- р╣Бр╕Бр╣Йр╣Др╕Вр╕лр╕бр╕▓р╕вр╣Ар╕ер╕Вр╕Др╕┤р╕зр╕Чр╕╡р╣Ир╕Лр╣Йр╕│ (р╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕З)
UPDATE queue_items 
SET queue_number = 1000 + id 
WHERE id IN (
  SELECT id FROM (
    SELECT id, ROW_NUMBER() OVER (PARTITION BY queue_number ORDER BY created_at) as rn
    FROM queue_items
  ) t WHERE t.rn > 1
);
```

### 3. р╕Чр╕Фр╕кр╕нр╕Ър╕гр╕░р╕Ър╕Ъ
1. р╣Др╕Ыр╕Чр╕╡р╣Ир╕лр╕Щр╣Йр╕▓ Home
2. р╕Бр╕Фр╕Ыр╕╕р╣Ир╕б "ЁЯФз р╕Чр╕Фр╕кр╕нр╕Ър╕гр╕░р╕Ър╕Ър╕Др╕┤р╕з"
3. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓р╕Вр╕╢р╣Йр╕Щр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕б "тЬЕ р╕гр╕░р╕Ър╕Ър╕Др╕┤р╕зр╕Юр╕гр╣Йр╕нр╕бр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щ р╕Юр╕гр╣Йр╕нр╕бр╕кр╕гр╣Йр╕▓р╕Зр╕лр╕бр╕▓р╕вр╣Ар╕ер╕Вр╕Др╕┤р╕з"

### 4. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Бр╕▓р╕гр╕Чр╕│р╕Зр╕▓р╕Щ
1. р╕ер╕нр╕Зр╣Бр╕ер╕Бр╣Вр╕Др╣Йр╕Фр╣Гр╕лр╕бр╣И
2. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓р╕кр╕▓р╕бр╕▓р╕гр╕Цр╕кр╕гр╣Йр╕▓р╕Зр╕лр╕бр╕▓р╕вр╣Ар╕ер╕Вр╕Др╕┤р╕зр╣Др╕Фр╣Й
3. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓р╕Др╕┤р╕зр╕Ыр╕гр╕▓р╕Бр╕Пр╣Гр╕Щр╕лр╕Щр╣Йр╕▓р╕Ир╕нр╣Бр╕кр╕Фр╕Зр╕Др╕┤р╕з

## р╕лр╕бр╕▓р╕вр╣Ар╕лр╕Хр╕╕
- р╕лр╕ер╕▒р╕Зр╕Ир╕▓р╕Бр╕ер╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Др╕┤р╕зр╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф р╕ер╕╣р╕Бр╕Др╣Йр╕▓р╕Ир╕░р╕Хр╣Йр╕нр╕Зр╣Бр╕ер╕Бр╣Вр╕Др╣Йр╕Фр╣Гр╕лр╕бр╣Ир╣Ар╕Юр╕╖р╣Ир╕нр╣Др╕Фр╣Йр╕гр╕▒р╕Ър╕лр╕бр╕▓р╕вр╣Ар╕ер╕Вр╕Др╕┤р╕з
- р╕гр╕░р╕Ър╕Ър╕Ир╕░р╣Ар╕гр╕┤р╣Ир╕бр╕кр╕гр╣Йр╕▓р╕Зр╕лр╕бр╕▓р╕вр╣Ар╕ер╕Вр╕Др╕┤р╕зр╣Гр╕лр╕бр╣Ир╕Чр╕╡р╣И 1
- р╕Бр╕▓р╕гр╣Бр╕Бр╣Йр╣Др╕Вр╕Щр╕╡р╣Йр╕Ир╕░р╕Ыр╣Йр╕нр╕Зр╕Бр╕▒р╕Щр╕Ыр╕▒р╕Нр╕лр╕▓р╕лр╕бр╕▓р╕вр╣Ар╕ер╕Вр╕Др╕┤р╕зр╕Лр╣Йр╕│р╣Гр╕Щр╕нр╕Щр╕▓р╕Др╕Х
